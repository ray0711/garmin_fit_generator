<div class="workout-container" cdkDropListGroup>
  <div class="building-blocks">
    <h2>Building Blocks</h2>
    <div
      cdkDropList
      [cdkDropListData]="buildingBlocks"
      cdkDropListSortingDisabled
      cdkDropListHasAnchor
      class="workout-list"
    >
      @for (block of buildingBlocks; track block.name) {
        <app-exercise [block]="block" class="block-box" (add)="addBlock($event)" />
      }
    </div>
    <mat-card appearance="outlined">
      <mat-card-header>
        <mat-card-title>Default Step Target</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <app-step-target [(workoutBlock)]="templateTarget" />
        <mat-card-actions>
          <button matFab extended (click)="applyDefaultTarget()">
            <mat-icon aria-hidden="true">app_registration</mat-icon>
            Apply to selected
          </button>
        </mat-card-actions>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="list-header">
    <h2>Workout</h2>
    <mat-card appearance="outlined" style="margin-bottom: 16px">
      <mat-card-header>
        <mat-card-title>Import / Export</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field style="width: 100%; margin-bottom: 16px">
          <mat-label>Workout Name</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="workoutName"
            placeholder="Enter workout name"
            maxlength="255"
          />
          @if (workoutName().length >= 255) {
            <mat-hint align="end">Maximum character limit reached (255)</mat-hint>
          }
        </mat-form-field>
        <app-fit-control
          [currentWorkout]="workout()"
          [workoutName]="workoutName()"
          (importWorkout)="onWorkoutSelected($event)"
          (workoutNameChange)="workoutName.set($event)"
        />
      </mat-card-content>
    </mat-card>

    <mat-tree
      [dataSource]="flatWorkoutOutput()"
      [trackBy]="treeTracker"
      [levelAccessor]="levelAccessor"
      class="workout-list"
      cdkDropList
      (cdkDropListDropped)="drop($event)"
      #workoutTree
    >
      <mat-tree-node *matTreeNodeDef="let node" class="block-box" cdkDropList cdkDrag>
        <app-control
          [block]="node.block"
          (blockChange)="updateBlockInWorkout($event)"
          (deleteMe)="deleteBlock(node)"
          [class]="levelStyle(node)"
        />
      </mat-tree-node>
    </mat-tree>
  </div>
</div>

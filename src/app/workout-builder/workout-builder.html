<div class="workout-container">
  <div cdkDropListGroup>
    <div class="list-header">
      <h2>Building Blocks</h2>
      <div
        cdkDropList
        [cdkDropListData]="buildingBlocks"
        cdkDropListSortingDisabled
        cdkDropListHasAnchor
        class="workout-list"
      >
        @for (block of buildingBlocks; track block.name) {
          <div class="block-box" cdkDrag [cdkDragData]="block">
            <button type="button" class="drag-handle" cdkDragHandle aria-label="Drag to add block">
              ⋮⋮
            </button>
            <app-exercise [block]="block" />
          </div>
        }
      </div>
    </div>

    <div class="list-header">
      <h2>Workout Tree</h2>
      <mat-tree
        [dataSource]="flatWorkoutOutput()"
        [levelAccessor]="levelAccessor"
        class="workout-list"
        cdkDropList
        (cdkDropListDropped)="drop($event)"
        #workoutTree
      >
        <mat-tree-node
          *matTreeNodeDef="let node"
          matTreeNodePadding
          class="block-box"
          cdkDropList
          cdkDrag
        >
          <button type="button" class="drag-handle" cdkDragHandle aria-label="Drag step">⋮⋮</button>
          <app-control [block]="node.block" />
        </mat-tree-node>
        <mat-tree-node
          *matTreeNodeDef="let node; when: isRepeat"
          matTreeNodePadding
          matTreeNodeToggle
          [cdkTreeNodeTypeaheadLabel]="node.block.name"
          class="repeat-block-box"
          cdkDropList
          cdkDrag
        >
          <button type="button" class="drag-handle" cdkDragHandle aria-label="Drag repeat group">⋮⋮</button>
          <app-control [block]="node.block" />
        </mat-tree-node>
      </mat-tree>
    </div>
  </div>
</div>

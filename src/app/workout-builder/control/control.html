<div class="control" (click)="this.toggleSelected()" [class.selected]="this.block()?.selected">
  <button matMiniFab cdkDragHandle aria-label="Drag step" class="drag-handle">
    <mat-icon aria-hidden="true">drag_indicator</mat-icon>
  </button>
  <div class="card-title" [title]="block()?.name">{{ block()?.name }}</div>
  <button matMiniFab aria-label="delete step" (click)="this.delete()">
    <mat-icon aria-hidden="true">delete</mat-icon>
  </button>

  @if (isRepeat()) {
    <form [formGroup]="repeatForm" class="form-grid">
      <mat-form-field class="form-field form-title">
        <mat-label>Sets</mat-label>
        <input matInput type="number" formControlName="sets" min="1" />
      </mat-form-field>
    </form>
  }

  @if (isWorkout()) {
    <form [formGroup]="workoutForm" class="form-grid" (click)="$event.stopPropagation()">
      <mat-form-field class="form-field form-title">
        <mat-label>Name override</mat-label>
        <input matInput type="text" formControlName="nameOverride" placeholder="Custom name" />
      </mat-form-field>

      <mat-form-field class="form-field">
        <mat-label>Intensity</mat-label>
        <mat-select formControlName="intensity">
          @for (opt of intensityOptions; track opt.value) {
            <mat-option [value]="opt.value">{{ opt.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field class="form-field form-notes">
        <mat-label>Notes</mat-label>
        <textarea
          matInput
          formControlName="notes"
          rows="1"
          aria-label="Workout step notes"
          placeholder="Add notes or cues"
        ></textarea>
      </mat-form-field>
      <app-step-target [(workoutBlock)]="this.workoutOrUndefined" class="step-target" />
    </form>
  }
</div>
